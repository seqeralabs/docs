---
title: "Use AWS IAM roles"
description: Use IAM Role instead of user credentials
date: "12 Apr 2023"
tags: [aws, iam, role]
---

:::note
This feature requires Tower 21.06.0 or later.
:::

AWS-based customers can configure Tower to interact with other AWS Services like Batch using an IAM Role rather than providing IAM User credentials.

## Configure the Tower IAM policy

!!! tip ""

    The provided policies were designed with certain assumptions:

    1. **IAM Policy**: Tower and Nextflow should have whole access to identified S3 Buckets.
    2. **Trust Policy**: The Role should be assumable by EC2, ECS, EKS, and only specifically-named IAM actors.

    You may wish to limit S3 access to specific prefixes, and/or Role assumption to more specific Platforms.

Create a custom IAM Policy ([Tower-Role-Policy.json](../_templates/Tower-Role-Policy.json)).

<details>
  <summary>Click to view custom Tower-Role-Policy.json</summary>

```json file=../_templates/Tower-Role-Policy.json

```

</details>

1.  Modify `BucketPolicy01` and `BucketPolicy02` with the name(s) of the your S3 Buckets.
1.  Revise (if necessary) the scope of access to a specific prefix in the S3 bucket(s).

## Modify the Tower IAM Role Trust Policy (optional)

Review and modify the Role Trust Policy ([Tower-Role-Trust-Policy.json](../_templates/Tower-Role-Trust-Policy.json)).

<details>
  <summary>Click to view Tower-Role-Trust-Policy</summary>

```json file=../_templates/Tower-Role-Trust-Policy.json

```

</details>

1.  Replace `YOUR-AWS-ACCOUNT` with your own AWS Account Id.

1.  Specify the Users and/or Roles able to assume the Tower IAM Role.

## Create the IAM artefacts

[Create the IAM Artefacts](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html) in your AWS Account.

1.  Navigate to the folder containing your configured IAM documents:

   ```bash
   cd <FOLDER_WITH_YOUR_CONFIGURED_IAM_DOCUMENTS>
   ```

1.  Create the **Role**:

   ```bash
   aws iam create-role --role-name Tower-Role --assume-role-policy-document file://Tower-Role-Trust-Policy.json
   ```

1.  Create an **inline policy** for the Role:

   ```bash
   aws iam put-role-policy --role-name Tower-Role --policy-name Tower-Role-Policy --policy-document file://Tower-Role-Policy.json
   ```

1.  Create an **instance profile**:

   ```bash
   aws iam create-instance-profile --instance-profile-name Tower-Instance
   ```

1.  **Bind** the Role to the instance profile:

   ```bash
   aws iam add-role-to-instance-profile --instance-profile-name Tower-Instance --role-name Tower-Role
   ```

## Configure Tower

With the IAM artefacts complete, update your Tower application configuration:

1.  Add the following entry to your `tower.env`

   ```env
   TOWER_ALLOW_INSTANCE_CREDENTIALS=true
   ```

1.  Restart the Tower application.

1.  Verify that the change took effect by querying the Tower instance `service-info` endpoint:

   ```bash
   curl -X GET "https://YOUR-TOWER-DOMAIN/api/service-info" -H "Accept: application/json" | jq ".serviceInfo.allowInstanceCredentials"
   ```

1.  Log in to Tower and create a new AWS credential. You are now prompted for an AWS `arn` instead of access keys.

   **Before Change**:
   ![](./_images/tower_credentials_aws_keys.png)

   **After Change**:
   ![](./_images/tower_credentials_aws_role.png)
