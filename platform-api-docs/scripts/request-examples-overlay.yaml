overlay: "1.0.0"
info:
  title: "Compute Environment Examples Enhancement"
  version: "1.0.0"
  description: "Adds comprehensive examples for creating compute environments across different cloud providers"

actions:
  # Add multiple provider examples to compute environment creation endpoint
  - target: "$.paths['/compute-envs'].post.requestBody.content['application/json']"
    update:
      examples:
        AwsBatchForge:
          description: "A minimal AWS Batch Forge compute environment with Wave and Fusion enabled."
          value:
            computeEnv:
              name: "aws-batch-ce"
              platform: "aws-batch"
              credentialsId: "your-aws-credentials-id"
              description: "Minimal AWS Batch Forge compute environment with Wave, Fusion, and fast instance storage enabled"
              config:
                region: "eu-west-2"
                forge:
                  type: "SPOT"
                  minCpus: "0"
                  maxCpus: "100"
                workDir: "s3://your-bucket/work"
                waveEnabled: "true"
                fusion2Enabled: "true"
                nvnmeStorageEnabled: "true"
        
        AwsCloud:
          description: "Minimal AWS Cloud compute environment with default instance type and AMI"
          value:
            computeEnv:
              name: "aws-cloud-ce"
              description: "Minimal AWS Cloud compute environment with default instance type and AMI"
              platform: "aws-cloud"
              credentialsId: "your-aws-credentials-id"
              config:
                region: "eu-west-2"
                workDir: "s3://your-bucket/work"
        
        GoogleBatch:
          description: "Minimal Google Cloud Batch compute environment with Wave and Fusion enabled"
          value:
            computeEnv:
              name: "google-batch-ce"
              description: "Minimal Google Cloud Batch compute environment with Wave and Fusion enabled"
              platform: "google-batch"
              credentialsId: "your-google-credentials-id"
              config:
                location: "europe-west2"
                workDir: "gs://your-bucket/work"
                spot: true
                waveEnabled: true
                fusion2Enabled: true
        
        GoogleCloud:
          description: "Minimal Google Cloud compute environment with default instance type and image ID"
          value:
            computeEnv:
              name: "google-cloud-ce"
              description: "Minimal Google Cloud compute environment with default instance type and image ID"
              platform: "google-cloud"
              credentialsId: "your-google-credentials-id"
              config:
                region: "europe-west2"
                workDir: "gs://your-bucket/work"
        
        AzureBatchForge:
          description: "Minimal Azure Batch Forge compute environment with Wave and Fusion enabled"
          value:
            computeEnv:
              name: "azure-batch-ce"
              description: "Minimal Azure Batch Forge compute environment with Wave and Fusion enabled"
              platform: "azure-batch"
              credentialsId: "your-azure-credentials-id"
              config:
                region: "eastus"
                workDir: "az://your-storage-account/work"
                forge:
                  vmCount: 50
                  autoScale: true
                waveEnabled: true
                fusion2Enabled: true
        
        AwsEks:
          description: "Minimal AWS EKS compute environment with Fusion storage"
          value:
            computeEnv:
              name: "aws-eks-ce"
              description: "Minimal AWS EKS compute environment with Fusion storage"
              platform: "eks-platform"
              credentialsId: "your-aws-credentials-id"
              config:
                region: "eu-west-2"
                workDir: "s3://your-bucket/work"
                clusterName: "your-cluster-name"
                namespace: "your-namespace"
                headServiceAccount: "your-service-account"
                waveEnabled: "true"
                fusion2Enabled: "true"
        
        GoogleGke:
          description: "Minimal Google Kubernetes Engine compute environment with Fusion storage"
          value:
            computeEnv:
              name: "gke-ce"
              description: "Minimal Google Kubernetes Engine compute environment with Fusion storage"
              platform: "gke-platform"
              credentialsId: "your-google-credentials-id"
              config:
                region: "europe-west2"
                workDir: "gs://your-bucket/work"
                clusterName: "your-cluster-name"
                namespace: "your-namespace"
                headServiceAccount: "your-service-account"
                waveEnabled: "true"
                fusion2Enabled: "true"
        
        Kubernetes:
          description: "Minimal Kubernetes compute environment with persistent volume storage"
          value:
            computeEnv:
              name: "k8s-ce"
              description: "Minimal Kubernetes compute environment with persistent volume storage"
              platform: "k8s-platform"
              credentialsId: "your-k8s-credentials-id"
              config:
                workDir: "/workspace"
                server: "https://your-k8s-api-server:6443"
                sslCert: "-----BEGIN CERTIFICATE-----\nYOUR_CERTIFICATE\n-----END CERTIFICATE-----"
                namespace: "your-namespace"
                headServiceAccount: "your-service-account"
                storageClaimName: "your-storage-claim"
                storageMountPath: "/workspace"

  # Add request example to POST /pipelines (CreatePipeline)
  - target: "$.paths./pipelines.post.requestBody.content.application/json"
    update:
      examples:
        BasicPipelineCreation:
          summary: "Create a pipeline with nf-core/rnaseq"
          description: "Minimal pipeline creation request using nf-core/rnaseq with the `test_full` configuration profile."
          value:
            name: "rnaseq-pipeline"
            description: "Minimal nf-core/rnaseq pipeline configuration with the `test_full` profile."
            launch:
              pipeline: "https://github.com/nf-core/rnaseq"
              computeEnvId: "your-compute-env-id"
              revision: "master"
              configProfiles:
                - "test_full"
              labelIds:
                - "label_id_1"
                - "label_id_2"
