[[edge_functions]]
  function = "og-generate.png"
  path = "/og-generate.png"

[build.environment]
  NODE_VERSION = "22"
  # Limit Node.js memory to 1GB (guaranteed allocation on Netlify)
  NODE_OPTIONS = "--max-old-space-size=2048"
  # Limit SSG worker threads to prevent OOM errors in Netlify builds
  # Docusaurus defaults to 32 threads with 1GB memory each, but Netlify's
  # memory limits aren't properly enforced, causing out-of-memory 137 errors.
  # Limiting thread processing avoids this issue with some build time impact however, 
  # build are still significantly faster than without SSG in-use.
  # Reference: https://github.com/facebook/docusaurus/discussions/11199
  DOCUSAURUS_SSG_WORKER_THREAD_COUNT = "1"

# Redirects for the missing API docs
[[redirects]]
  from = "/platform-api/*"
  to = "https://seqera-docs-api.netlify.app/platform-api/:splat"
  status = 200

[context.deploy-preview.build.environment]
  INCLUDE_NEXT="true"

# Redirect missing assets (so that we don't lose CSS on the API docs)
# NB: Force is not true, so will use local if available
[[redirects]]
  from = "/assets/*"
  to = "https://seqera-docs-api.netlify.app/assets/:splat"
  status = 200

